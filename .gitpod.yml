# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

tasks:
  - name: Instalar Python
    init: > 
      pyenv install 3.10.7 -f &&
      pyenv local 3.10.7 &&
      gp sync-done bundle
  - name: Instalar dependencias
    init: gp sync-await bundle
    command: pip install --upgrade --no-cache-dir pip setuptools wheel && pip install --no-cache-dir wheel && pip install -r requirements.txt && gp sync-done requirements
  - name: Crear folder para datos, clientes, conectores y asigna permisos
    init: > 
      mkdir -p data/bookkeeper && 
      mkdir -p data/zookeeper && 
      mkdir -p data/mysql && 
      sudo chmod -R 777 data &&
      sudo chmod -R 777 connectors
  - name: Start services db
    init: >
      docker-compose --profile db up
  - name: Start services redis
    init: >
      docker-compose --profile redis up
  - name: start pulsar
    init: >
      docker-compose --profile pulsar up
  - name: Configuranto timeout
    init: gp sync-await requirements
    command: sleep 50 &&  gp sync-done set_timeout
  - name: update permissions
    init: gp sync-await set_timeout
    command: sudo chmod -R 777 data && sudo chmod -R 777 connectors && gp sync-done update_permissions
  - name: Start client services
    init: gp sync-await update_permissions
    command: flask --app src/clientes/api run --debugger --no-reload -p 3000
  - name: Start client properties
    init: gp sync-await update_permissions
    command: flask --app src/propiedadesalpes/api run --debugger --no-reload -p 5000
  - name: Start client companies
    init: gp sync-await update_permissions
    command: flask --app src/company/api run --debugger --no-reload -p 6000
  - name: Start client sales
    init: gp sync-await update_permissions
    command: flask --app src/sales/api run --debugger --no-reload -p 7000

  
ports:
  - port: 2181
    onOpen: ignore
  - port: 8080
    onOpen: ignore
  - port: 6650
    onOpen: ignore
  - port: 2181
    onOpen: ignore
  - port: 6650
    onOpen: ignore
  - port: 5000
    onOpen: ignore
  - port: 6000
    onOpen: ignore
  - port: 7000
    onOpen: ignore
  - port: 3000
    onOpen: ignore
